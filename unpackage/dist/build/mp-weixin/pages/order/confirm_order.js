(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirm_order"],{"2bd3":function(e,o,n){"use strict";n.d(o,"b",(function(){return r})),n.d(o,"c",(function(){return i})),n.d(o,"a",(function(){return t}));var t={uSelect:function(){return n.e("uview-ui/components/u-select/u-select").then(n.bind(null,"4710"))},uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"84d6"))}},r=function(){var e=this.$createElement,o=(this._self._c,this.orderInfo.address.length);this.$mp.data=Object.assign({},{$root:{g0:o}})},i=[]},"727b":function(e,o,n){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n={data:function(){return{show:!1,timeShow:!1,sendShow:!1,checked:"",arriveDay:"",sendTime:"选择预约配送时间",coupon:"",couponNum:"",invoice:"不开发票",remark:"选填，可填写特殊需求等",number:1,defaultTime:[0,0],defaultInvoice:[0],orderInfo:[],from:{},stock:"",list:[{value:"0",label:"不开发票"},{value:"1",label:"开发票"}],timeList:[]}},onLoad:function(o){var n=this;console.log(o.stock),"undefined"!=o.stock&&(this.stock=o.stock),console.log(this.stock);if(1==o.stock){var t=new Date,r=t.getFullYear(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,a=t.getDate()<10?"0"+t.getDate():t.getDate(),s=r+"-"+i+"-"+a;this.sendTime="立即送出",this.arriveDay=s,console.log(this.timeList)}for(var l=new Date,d=l.getTime(),c={},u=0;u<30;u++){var f=d+864e5*u,h=new Date(f),m=(r=h.getFullYear(),h.getMonth()+1<10?"0"+(h.getMonth()+1):h.getMonth()+1),v=(t=h.getDate()<10?"0"+(h.getDate()+1):h.getDate()+1,r+"-"+m+"-"+t);"日一二三四五六".charAt(h.getDay());c[u]={},c[u].label="",c[u].value=u,c[u].label=v,this.timeList[0]=c}var p=[],g=[];for(u=0;u<12;u++){p[u]={},g[u]={},g[u].label="",p[u].label="",p[u].label+=7+2*u>24?7+2*u-24:7+2*u,p[u].label=(p[u].label<10?"0"+p[u].label:p[u].label)+":00";var _=u+1,b=u;g[u].label+=7+2*_>24?7+2*_-24:7+2*_,g[u].label=(g[b].label<10?"0"+g[b].label:g[b].label)+":00",p[u].label+="-"+g[u].label,p[u].value=u}this.timeList[1]=p;var k=e.getStorageSync("order_key");this.$u.post("/order/previewOrder",k).then((function(e){0==e.error&&(console.log("123"),n.orderInfo=e.data,n.from=k,n.from.is_invoice=0,n.couponNum="可用"+e.data.CouponList.length+"张",n.from.address_id=e.data.address.address_id,console.log(n.from))}))},onShow:function(){var o=this;""!=e.getStorageSync("remarks")?(this.remark=e.getStorageSync("remarks"),this.from.remark=this.remark):(this.remark="选填，可填写特殊需求等",this.from.remark=""),e.$on("address_id",(function(n){o.from.address_id=n.address_id,""!=n.address_id&&o.$u.post("/ucenter/getUserRegions").then((function(e){0==e.error&&(o.orderInfo.address=e.data.items.filter((function(e){return e.address_id==n.address_id})),o.orderInfo.address=o.orderInfo.address[0])})),e.$off("address_id")})),e.$on("invoice_id",(function(n){console.log(n),o.from.is_invoice=n.invoice_id,e.$off("invoice_id")})),e.$on("m_coupon_id",(function(n){o.from.coupon_id=n.m_coupon_id,o.from.use_voucher=0;var t=e.getStorageSync("order_key");o.$u.post("/order/previewOrder",t).then((function(e){if(0==e.error){console.log("id"),o.orderInfo.Allprice=e.data.Allprice;var t=e.data.CouponList.filter((function(e){return n.m_coupon_id==e.m_coupon_id}));o.checked=!1,o.coupon=-t[0].coupon_money,o.coupon=o.keepFull(o.coupon),o.orderInfo.Allprice=+o.orderInfo.Allprice+ +o.coupon,o.orderInfo.Allprice=o.keepFull(o.orderInfo.Allprice),o.orderInfo.Allprice<=0&&(o.orderInfo.Allprice=.01)}})),e.$off("coupon_id")}))},methods:{confirm:function(o){console.log(o[0].value),this.defaultInvoice=[o[0].value],this.invoice=o[0].label,1==o[0].value&&e.navigateTo({url:"../index/invoice/invoice?id=1"})},keepFull:function(e){var o=Math.round(100*e)/100,n=o.toString(),t=n.indexOf(".");t<0&&(t=n.length,n+=".");while(n.length<=t+2)n+="0";return n},chooseInvoice:function(){this.show=!0},toRemarks:function(){e.navigateTo({url:"remarks"})},cardCheck:function(){var o=this;this.checked=!this.checked;var n=e.getStorageSync("order_key");this.$u.post("/order/previewOrder",n).then((function(e){if(0==e.error){o.orderInfo=e.data,console.log(o.orderInfo.Allprice);var n=parseFloat(o.orderInfo.Allprice),t=parseFloat(o.orderInfo.discount_money);1==o.checked?(n=+(n-t).toFixed(2),o.from.coupon_id="",o.from.use_voucher=t,1==isFinite(o.coupon)&&(o.coupon="")):o.from.use_voucher=0,o.orderInfo.Allprice=n,o.orderInfo.Allprice=o.keepFull(o.orderInfo.Allprice)}}))},toCoupon:function(){e.navigateTo({url:"usCoupon"})},toAddress:function(){e.navigateTo({url:"../user_info/address/address?id=1"})},sendConfirm:function(e){this.arriveDay=e[0].label,this.sendTime=e[1].label;var o=this.sendTime.slice(6,11);console.log(o),this.from.need_time=this.arriveDay+"-"+o,console.log(this.from.need_time),this.defaultTime=[e[0].value,e[1].value]},openSennd:function(){"立即送出"!=this.sendTime&&(this.sendShow=!0)},toPay:function(){console.log(this.stock),void 0==this.from.address_id?e.showToast({title:"请添加收获地址",icon:"none"}):""==this.stock?(console.log(this.from.need_time),void 0==this.from.need_time?(e.showToast({title:"请选择配送时间",icon:"none"}),this.sendShow=!0):this.pay()):this.pay()},pay:function(){this.$u.post("/order/createOrder",this.from).then((function(o){0==o.error?e.navigateTo({url:"payment?order_id="+o.data}):e.showToast({title:o.msg,icon:"none"})}))}},onUnload:function(){e.removeStorageSync("remarks")}};o.default=n}).call(this,n("df3c")["default"])},a2ee:function(e,o,n){},b7fe:function(e,o,n){"use strict";(function(e,o){var t=n("47a9");n("d3e5");t(n("3240"));var r=t(n("f9a6"));e.__webpack_require_UNI_MP_PLUGIN__=n,o(r.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])},e927:function(e,o,n){"use strict";var t=n("a2ee"),r=n.n(t);r.a},ed3f:function(e,o,n){"use strict";n.r(o);var t=n("727b"),r=n.n(t);for(var i in t)["default"].indexOf(i)<0&&function(e){n.d(o,e,(function(){return t[e]}))}(i);o["default"]=r.a},f9a6:function(e,o,n){"use strict";n.r(o);var t=n("2bd3"),r=n("ed3f");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(o,e,(function(){return r[e]}))}(i);n("e927");var a=n("828b"),s=Object(a["a"])(r["default"],t["b"],t["c"],!1,null,null,null,!1,t["a"],void 0);o["default"]=s.exports}},[["b7fe","common/runtime","common/vendor"]]]);