(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/confirm_order"],{"191b":function(e,o,t){"use strict";t.r(o);var n=t("1e53"),i=t.n(n);for(var r in n)"default"!==r&&function(e){t.d(o,e,(function(){return n[e]}))}(r);o["default"]=i.a},"1e53":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var t={data:function(){return{show:!1,timeShow:!1,sendShow:!1,checked:"",arriveDay:"",sendTime:"选择预约配送时间",coupon:"",couponNum:"",invoice:"不开发票",remark:"选填，可填写特殊需求等",number:1,defaultTime:[0,0],defaultInvoice:[0],orderInfo:[],from:{},stock:"",list:[{value:"0",label:"不开发票"},{value:"1",label:"开发票"}],timeList:[]}},onLoad:function(o){var t=this;console.log(o.stock),"undefined"!=o.stock&&(this.stock=o.stock),console.log(this.stock);var n=7;if(1==o.stock){var i=new Date,r=i.getFullYear(),s=i.getMonth()+1<10?"0"+(i.getMonth()+1):i.getMonth()+1,a=i.getDate()<10?"0"+i.getDate():i.getDate(),c=r+"-"+s+"-"+a;this.sendTime="立即送出",this.arriveDay=c,console.log(this.timeList)}for(var l=new Date,u=l.getTime(),d=864e5,f={},h=0;h<30;h++){var m=u+h*d,v=new Date(m),p=(r=v.getFullYear(),v.getMonth()+1<10?"0"+(v.getMonth()+1):v.getMonth()+1),g=(i=v.getDate()<10?"0"+(v.getDate()+1):v.getDate()+1,r+"-"+p+"-"+i);"日一二三四五六".charAt(v.getDay());f[h]={},f[h].label="",f[h].value=h,f[h].label=g,this.timeList[0]=f}var _=[],b=[];for(h=0;h<12;h++){_[h]={},b[h]={},b[h].label="",_[h].label="",_[h].label+=n+2*h>24?n+2*h-24:n+2*h,_[h].label=(_[h].label<10?"0"+_[h].label:_[h].label)+":00";var k=h+1,w=h;b[h].label+=n+2*k>24?n+2*k-24:n+2*k,b[h].label=(b[w].label<10?"0"+b[w].label:b[w].label)+":00",_[h].label+="-"+b[h].label,_[h].value=h}this.timeList[1]=_;var I=e.getStorageSync("order_key");this.$u.post("/order/previewOrder",I).then((function(e){0==e.error&&(console.log("123"),t.orderInfo=e.data,t.from=I,t.from.is_invoice=0,t.couponNum="可用"+e.data.CouponList.length+"张",t.from.address_id=e.data.address.address_id,console.log(t.from))}))},onShow:function(){var o=this;""!=e.getStorageSync("remarks")?(this.remark=e.getStorageSync("remarks"),this.from.remark=this.remark):(this.remark="选填，可填写特殊需求等",this.from.remark=""),e.$on("address_id",(function(t){o.from.address_id=t.address_id,""!=t.address_id&&o.$u.post("/ucenter/getUserRegions").then((function(e){0==e.error&&(o.orderInfo.address=e.data.items.filter((function(e){return e.address_id==t.address_id})),o.orderInfo.address=o.orderInfo.address[0])})),e.$off("address_id")})),e.$on("invoice_id",(function(t){console.log(t),o.from.is_invoice=t.invoice_id,e.$off("invoice_id")})),e.$on("m_coupon_id",(function(t){o.from.coupon_id=t.m_coupon_id,o.from.use_voucher=0;var n=e.getStorageSync("order_key");o.$u.post("/order/previewOrder",n).then((function(e){if(0==e.error){console.log("id"),o.orderInfo.Allprice=e.data.Allprice;var n=e.data.CouponList.filter((function(e){return t.m_coupon_id==e.m_coupon_id}));o.checked=!1,o.coupon=-n[0].coupon_money,o.coupon=o.keepFull(o.coupon),o.orderInfo.Allprice=+o.orderInfo.Allprice+ +o.coupon,o.orderInfo.Allprice=o.keepFull(o.orderInfo.Allprice)}})),e.$off("coupon_id")}))},methods:{confirm:function(o){console.log(o[0].value),this.defaultInvoice=[o[0].value],this.invoice=o[0].label,1==o[0].value&&e.navigateTo({url:"../index/invoice/invoice?id=1"})},keepFull:function(e){var o=Math.round(100*e)/100,t=o.toString(),n=t.indexOf(".");n<0&&(n=t.length,t+=".");while(t.length<=n+2)t+="0";return t},chooseInvoice:function(){this.show=!0},toRemarks:function(){e.navigateTo({url:"remarks"})},cardCheck:function(){this.checked=!this.checked;var e=parseFloat(this.orderInfo.Allprice),o=parseFloat(this.orderInfo.discount_money);1==this.checked?(e=+(e-o).toFixed(2),console.log(isFinite(this.coupon)),this.from.coupon_id="",this.from.use_voucher=o,1==isFinite(this.coupon)&&(e=+(e-this.coupon).toFixed(2),console.log(e),this.coupon="")):(e=+(+e+ +o).toFixed(2),this.from.use_voucher=0,1==isFinite(this.coupon)&&(e=+(e-this.coupon).toFixed(2))),this.orderInfo.Allprice=e,this.orderInfo.Allprice=this.keepFull(this.orderInfo.Allprice)},toCoupon:function(){e.navigateTo({url:"usCoupon"})},toAddress:function(){e.navigateTo({url:"../user_info/address/address?id=1"})},sendConfirm:function(e){this.arriveDay=e[0].label,this.sendTime=e[1].label;var o=this.sendTime.slice(6,11);console.log(o),this.from.need_time=this.arriveDay+"-"+o,console.log(this.from.need_time),this.defaultTime=[e[0].value,e[1].value]},openSennd:function(){"立即送出"!=this.sendTime&&(this.sendShow=!0)},toPay:function(){console.log(this.stock),void 0==this.from.address_id?e.showToast({title:"请添加收获地址",icon:"none"}):""==this.stock?(console.log(this.from.need_time),void 0==this.from.need_time?(e.showToast({title:"请选择配送时间",icon:"none"}),this.sendShow=!0):this.pay()):this.pay()},pay:function(){this.$u.post("/order/createOrder",this.from).then((function(o){0==o.error?e.navigateTo({url:"payment?order_id="+o.data}):e.showToast({title:o.msg,icon:"none"})}))}},onUnload:function(){e.removeStorageSync("remarks")}};o.default=t}).call(this,t("f266")["default"])},"26b8":function(e,o,t){"use strict";(function(e,o){t("c264");i(t("66fd"));var n=i(t("52e4"));function i(e){return e&&e.__esModule?e:{default:e}}e.__webpack_require_UNI_MP_PLUGIN__=t,o(n.default)}).call(this,t("f266")["default"],t("f266")["createPage"])},"52e4":function(e,o,t){"use strict";t.r(o);var n=t("d160"),i=t("191b");for(var r in i)"default"!==r&&function(e){t.d(o,e,(function(){return i[e]}))}(r);t("6916");var s,a=t("f0c5"),c=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);o["default"]=c.exports},6916:function(e,o,t){"use strict";var n=t("a0ca"),i=t.n(n);i.a},a0ca:function(e,o,t){},d160:function(e,o,t){"use strict";t.d(o,"b",(function(){return i})),t.d(o,"c",(function(){return r})),t.d(o,"a",(function(){return n}));var n={uSelect:function(){return t.e("uview-ui/components/u-select/u-select").then(t.bind(null,"9625"))},uIcon:function(){return t.e("uview-ui/components/u-icon/u-icon").then(t.bind(null,"6f1a"))}},i=function(){var e=this,o=e.$createElement;e._self._c},r=[]}},[["26b8","common/runtime","common/vendor"]]]);